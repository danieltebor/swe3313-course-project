@page "/login"

@inject NavigationManager NavigationManager

@using HanksMineralEmporium.Service.AuthenticationService
@inject IAuthenticationService AuthenticationService

<MudStack>
    <MudPaper Class="pa-4" Style ="background:#124419">
        <MudStack>
            <MudPaper Class="pa-4" Style="background:#9A8716;">

                <MudText Align="Align.Center" Style="@($"color:{Colors.Shades.Black};")" Typo="Typo.h6">Login</MudText>
                <br>

                <MudTextField T="string" Label="Username" @bind-Value="username"/>
                <MudTextField T="string" Label="Password" @bind-Value="password"/>
                <br>

                <MudStack>
                    <MudPaper Class="d-flex align-center flex-grow-1 gap-4" Elevation="0">
                        <MudButton Class="py-2 d-flex flex-1" Variant="Variant.Filled" Style="@($"color:{Colors.Shades.White}; background:{Colors.Grey.Default};")" OnClick="() => Submit()">Submit</MudButton>
                    </MudPaper>
                </MudStack>

                <br>
                <MudStack>
                    <MudPaper Class="d-flex align-center flex-grow-1 gap-4" Elevation="0">
                        <MudButton Class="py-2 d-flex flex-1" Variant="Variant.Filled" Style="@($"color:{Colors.Shades.White}; background:{Colors.Grey.Default};")" OnClick="() => Return()">Return</MudButton>
                    </MudPaper>
                </MudStack>

                @if (!string.IsNullOrEmpty(errorMessage))
                {
                    <MudText Color="Color.Error">@errorMessage</MudText>
                }

                <MudText>
                    Don't have an account? 
                    <a href="/register">Register</a>
                </MudText>
            </MudPaper>
        </MudStack>
    </MudPaper>
</MudStack>

@code {
    private string errorMessage = "";

    private string username = "";
    private string password = "";

    private async Task Submit()
    {
        try
        {
            await AuthenticationService.LoginUserAsync(username, password);
            NavigationManager.NavigateTo("/");
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
        }
    }

    private void Return()
    {
        NavigationManager.NavigateTo("/");
    }
}